{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2>üîç –ß–µ–∫–µ—Ä Roblox –∫—É–∫–∏</h2>
    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å, –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ</p>
    
    <div class="checker-form">
        <textarea 
            id="cookies-input" 
            class="neon-textarea" 
            placeholder="–í–≤–µ–¥–∏—Ç–µ Roblox –∫—É–∫–∏ (.ROBLOSECURITY):
_|WARNING:-DO-NOT-SHARE-THIS.--Sharing-this-will-allow-someone-to-log-in-to-your-account-and-to-steal-your-ROBUX-and-items|_
–ú–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—É–∫–∏, –∫–∞–∂–¥—É—é —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
–ú–∞–∫—Å–∏–º—É–º 50 –∫—É–∫–∏ –∑–∞ —Ä–∞–∑"
            rows="10"
        ></textarea>
        
        <button class="neon-button large" onclick="checkCookies()">
            üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
        </button>
        
        <div class="progress-bar" id="progress-bar" style="display: none;">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>
</div>

<div class="card">
    <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏</h2>
    <div id="checker-results" class="results-container">
        <p class="placeholder-text">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—É–∫–∏...</p>
    </div>
</div>

<script>
function checkCookies() {
    const cookiesText = document.getElementById('cookies-input').value;
    const resultsDiv = document.getElementById('checker-results');
    const progressBar = document.getElementById('progress-bar');
    const progressFill = document.getElementById('progress-fill');
    
    if (!cookiesText.trim()) {
        resultsDiv.innerHTML = '<div class="result-item result-invalid">–í–≤–µ–¥–∏—Ç–µ –∫—É–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏!</div>';
        return;
    }
    
    const cookiesCount = cookiesText.split('\n').filter(cookie => cookie.trim()).length;
    if (cookiesCount > 50) {
        resultsDiv.innerHTML = '<div class="result-item result-invalid">–ú–∞–∫—Å–∏–º—É–º 50 –∫—É–∫–∏ –∑–∞ —Ä–∞–∑!</div>';
        return;
    }
    
    resultsDiv.innerHTML = '<p>üîÑ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—É–∫–∏... –ü–æ–¥–æ–∂–¥–∏—Ç–µ</p>';
    progressBar.style.display = 'block';
    progressFill.style.width = '0%';
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    let progress = 0;
    const progressInterval = setInterval(() => {
        progress += 1;
        progressFill.style.width = Math.min(progress, 90) + '%';
        if (progress >= 90) clearInterval(progressInterval);
    }, 50);
    
    fetch('/api/check_accounts', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({cookies: cookiesText})
    })
    .then(response => response.json())
    .then(data => {
        clearInterval(progressInterval);
        progressFill.style.width = '100%';
        setTimeout(() => progressBar.style.display = 'none', 1000);
        displayCookieResults(data.results);
        updateStats();
    })
    .catch(error => {
        clearInterval(progressInterval);
        progressBar.style.display = 'none';
        console.error('Error:', error);
        resultsDiv.innerHTML = '<div class="result-item result-invalid">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫—É–∫–∏</div>';
    });
}

function displayCookieResults(results) {
    const resultsDiv = document.getElementById('checker-results');
    let html = '<h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫—É–∫–∏:</h3>';
    
    let validCount = 0, limitedCount = 0, bannedCount = 0, invalidCount = 0;
    let totalRobux = 0, premiumCount = 0;
    
    results.forEach(result => {
        const statusClass = `result-${result.status}`;
        const statusIcon = result.status === 'valid' ? '‚úÖ' : 
                          result.status === 'limited' ? '‚ö†Ô∏è' : 
                          result.status === 'banned' ? '‚ùå' : '‚ùì';
        
        html += `
            <div class="result-item ${statusClass}">
                <div class="result-header">
                    <strong>${result.username || 'Unknown'} (ID: ${result.user_id || 'N/A'})</strong>
                    <span class="status-badge">${statusIcon} ${result.status.toUpperCase()}</span>
                </div>
                <div class="result-details">
                    ${result.details}
                    ${result.robux ? ` | üí∞ ${result.robux} Robux` : ''}
                    ${result.premium ? ' | ‚≠ê Premium' : ''}
                    ${result.friends_count ? ` | üë• ${result.friends_count} friends` : ''}
                    ${result.followers_count ? ` | üìà ${result.followers_count} followers` : ''}
                    ${result.created ? ` | üóìÔ∏è Created: ${result.created.split('T')[0]}` : ''}
                </div>
            </div>
        `;
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        if (result.status === 'valid') validCount++;
        else if (result.status === 'limited') limitedCount++;
        else if (result.status === 'banned') bannedCount++;
        else invalidCount++;
        
        if (result.robux) totalRobux += result.robux;
        if (result.premium) premiumCount++;
    });
    
    // –°–≤–æ–¥–∫–∞
    html += `
        <div class="results-summary">
            <h4>üìà –°–≤–æ–¥–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:</h4>
            <p>‚úÖ –í–∞–ª–∏–¥–Ω—ã—Ö: ${validCount} | ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö: ${limitedCount} | ‚ùå –ó–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö: ${bannedCount} | ‚ùì –ù–µ–≤–∞–ª–∏–¥–Ω—ã—Ö: ${invalidCount}</p>
            <p>üí∞ –í—Å–µ–≥–æ Robux: ${totalRobux} | ‚≠ê Premium –∞–∫–∫–∞—É–Ω—Ç–æ–≤: ${premiumCount}</p>
        </div>
    `;
    
    resultsDiv.innerHTML = html;
}
</script>
{% endblock %}