{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2>üîç –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Roblox –∞–∫–∫–∞—É–Ω—Ç–æ–≤</h2>
    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å, –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞–∫–∫–∞—É–Ω—Ç–µ</p>
    
    <div class="checker-form">
        <textarea 
            id="cookies-input" 
            class="neon-textarea" 
            placeholder="–í–≤–µ–¥–∏—Ç–µ Roblox –∫—É–∫–∏ (.ROBLOSECURITY):
_|WARNING:-DO-NOT-SHARE-THIS.--Sharing-this-will-allow-someone-to-log-in-to-your-account-and-to-steal-your-ROBUX-and-items|_
–ú–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—É–∫–∏, –∫–∞–∂–¥—É—é —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
–ú–∞–∫—Å–∏–º—É–º 20 –∫—É–∫–∏ –∑–∞ —Ä–∞–∑ (–¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)"
            rows="8"
        ></textarea>
        
        <button class="neon-button large" onclick="checkCookies()">
            üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
        </button>
        
        <div class="progress-bar" id="progress-bar" style="display: none;">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>
</div>

<div class="card">
    <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏</h2>
    <div id="checker-results" class="results-container">
        <p class="placeholder-text">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...</p>
    </div>
</div>

<script>
function checkCookies() {
    const cookiesText = document.getElementById('cookies-input').value;
    const resultsDiv = document.getElementById('checker-results');
    const progressBar = document.getElementById('progress-bar');
    const progressFill = document.getElementById('progress-fill');
    
    if (!cookiesText.trim()) {
        resultsDiv.innerHTML = '<div class="result-item result-invalid">–í–≤–µ–¥–∏—Ç–µ –∫—É–∫–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏!</div>';
        return;
    }
    
    const cookiesCount = cookiesText.split('\n').filter(cookie => cookie.trim()).length;
    if (cookiesCount > 20) {
        resultsDiv.innerHTML = '<div class="result-item result-invalid">–ú–∞–∫—Å–∏–º—É–º 20 –∫—É–∫–∏ –∑–∞ —Ä–∞–∑!</div>';
        return;
    }
    
    resultsDiv.innerHTML = '<p>üîÑ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏... –≠—Ç–æ –∑–∞–π–º–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è</p>';
    progressBar.style.display = 'block';
    progressFill.style.width = '0%';
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    let progress = 0;
    const progressInterval = setInterval(() => {
        progress += 1;
        progressFill.style.width = Math.min(progress, 90) + '%';
        if (progress >= 90) clearInterval(progressInterval);
    }, 100);
    
    fetch('/api/check_accounts', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({cookies: cookiesText})
    })
    .then(response => response.json())
    .then(data => {
        clearInterval(progressInterval);
        progressFill.style.width = '100%';
        setTimeout(() => progressBar.style.display = 'none', 1000);
        displayCookieResults(data.results);
        updateStats();
        updateUserStats();
    })
    .catch(error => {
        clearInterval(progressInterval);
        progressBar.style.display = 'none';
        console.error('Error:', error);
        resultsDiv.innerHTML = '<div class="result-item result-invalid">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫—É–∫–∏</div>';
    });
}

function displayCookieResults(results) {
    const resultsDiv = document.getElementById('checker-results');
    let html = '<h3>üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:</h3>';
    
    let validCount = 0, limitedCount = 0, bannedCount = 0, invalidCount = 0;
    let totalRobux = 0, premiumCount = 0;
    let totalSpent = 0;
    
    results.forEach(result => {
        const statusClass = `result-${result.status}`;
        const statusIcon = result.status === 'valid' ? '‚úÖ' : 
                          result.status === 'limited' ? '‚ö†Ô∏è' : 
                          result.status === 'banned' ? '‚ùå' : '‚ùì';
        
        // –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
        const security = result.security || {};
        const billing = result.billing_info || {};
        
        html += `
            <div class="result-item ${statusClass}">
                <div class="result-header">
                    <div>
                        <strong>${result.username || 'Unknown'}</strong>
                        <div style="font-size: 0.9em; color: var(--text-muted);">
                            ID: ${result.user_id || 'N/A'} | Display: ${result.display_name || 'Unknown'}
                        </div>
                    </div>
                    <span class="status-badge">${statusIcon} ${result.status.toUpperCase()}</span>
                </div>
                
                <div class="result-details">
                    <div style="margin-bottom: 0.5rem;">
                        ${result.details}
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                        <div>
                            <strong>üí∞ –§–∏–Ω–∞–Ω—Å—ã:</strong><br>
                            ‚Ä¢ Robux: ${result.robux || 0}<br>
                            ‚Ä¢ Premium: ${result.premium ? '‚≠ê –î–∞' : '‚ùå –ù–µ—Ç'}<br>
                            ‚Ä¢ –ü–æ—Ç—Ä–∞—á–µ–Ω–æ: ${billing.total_spent || 0} R$
                        </div>
                        
                        <div>
                            <strong>üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:</strong><br>
                            ‚Ä¢ 2FA: ${security['2fa_enabled'] ? '‚úÖ' : '‚ùå'}<br>
                            ‚Ä¢ Email: ${security.email_verified ? '‚úÖ' : '‚ùå'}<br>
                            ‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω: ${security.phone_linked ? '‚úÖ' : '‚ùå'}<br>
                            ‚Ä¢ PIN: ${security.pin_enabled ? '‚úÖ' : '‚ùå'}
                        </div>
                        
                        <div>
                            <strong>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</strong><br>
                            ‚Ä¢ –°–æ–∑–¥–∞–Ω: ${result.created || 'Unknown'}<br>
                            ‚Ä¢ –î—Ä—É–∑—å—è: ${result.friends_count || 0}<br>
                            ‚Ä¢ –ü–æ–¥–ø–∏—Å—á–∏–∫–∏: ${result.followers_count || 0}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        if (result.status === 'valid') validCount++;
        else if (result.status === 'limited') limitedCount++;
        else if (result.status === 'banned') bannedCount++;
        else invalidCount++;
        
        if (result.robux) totalRobux += result.robux;
        if (result.premium) premiumCount++;
        if (billing.total_spent) totalSpent += billing.total_spent;
    });
    
    // –°–≤–æ–¥–∫–∞
    html += `
        <div class="results-summary">
            <h4>üìà –ò—Ç–æ–≥–æ–≤–∞—è —Å–≤–æ–¥–∫–∞:</h4>
            <p><strong>–ê–∫–∫–∞—É–Ω—Ç—ã:</strong> ‚úÖ ${validCount} | ‚ö†Ô∏è ${limitedCount} | ‚ùå ${bannedCount} | ‚ùì ${invalidCount}</p>
            <p><strong>–§–∏–Ω–∞–Ω—Å—ã:</strong> üí∞ ${totalRobux} Robux | ‚≠ê ${premiumCount} Premium | üí∏ ${totalSpent} R$ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ</p>
            <p><strong>–í—Å–µ–≥–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ:</strong> ${results.length} –∞–∫–∫–∞—É–Ω—Ç–æ–≤</p>
        </div>
    `;
    
    resultsDiv.innerHTML = html;
}
</script>
{% endblock %}