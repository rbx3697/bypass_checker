{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2>üîç –ß–µ–∫–µ—Ä –∞–∫–∫–∞—É–Ω—Ç–æ–≤</h2>
    <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ Roblox –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å, –±–∞–ª–∞–Ω—Å –∏ —Å—Ç–∞—Ç—É—Å</p>
    
    <div class="checker-form">
        <textarea 
            id="accounts-input" 
            class="neon-textarea" 
            placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
username:password
user2:pass123
user3:password456
–ú–∞–∫—Å–∏–º—É–º 100 –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∑–∞ —Ä–∞–∑"
            rows="10"
        ></textarea>
        
        <button class="neon-button large" onclick="checkAccounts()">
            üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
        </button>
        
        <div class="progress-bar" id="progress-bar" style="display: none;">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
    </div>
</div>

<div class="card">
    <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏</h2>
    <div id="checker-results" class="results-container">
        <p class="placeholder-text">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...</p>
    </div>
</div>

<script>
function checkAccounts() {
    const accountsText = document.getElementById('accounts-input').value;
    const resultsDiv = document.getElementById('checker-results');
    const progressBar = document.getElementById('progress-bar');
    const progressFill = document.getElementById('progress-fill');
    
    if (!accountsText.trim()) {
        resultsDiv.innerHTML = '<div class="result-item result-invalid">–í–≤–µ–¥–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏!</div>';
        return;
    }
    
    const accountsCount = accountsText.split('\n').filter(acc => acc.trim()).length;
    if (accountsCount > 100) {
        resultsDiv.innerHTML = '<div class="result-item result-invalid">–ú–∞–∫—Å–∏–º—É–º 100 –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –∑–∞ —Ä–∞–∑!</div>';
        return;
    }
    
    resultsDiv.innerHTML = '<p>üîÑ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏... –ü–æ–¥–æ–∂–¥–∏—Ç–µ</p>';
    progressBar.style.display = 'block';
    progressFill.style.width = '0%';
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    let progress = 0;
    const progressInterval = setInterval(() => {
        progress += 1;
        progressFill.style.width = Math.min(progress, 90) + '%';
        if (progress >= 90) clearInterval(progressInterval);
    }, 50);
    
    fetch('/api/check_accounts', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({accounts: accountsText})
    })
    .then(response => response.json())
    .then(data => {
        clearInterval(progressInterval);
        progressFill.style.width = '100%';
        setTimeout(() => progressBar.style.display = 'none', 1000);
        displayResults(data.results);
        updateStats();
    })
    .catch(error => {
        clearInterval(progressInterval);
        progressBar.style.display = 'none';
        console.error('Error:', error);
        resultsDiv.innerHTML = '<div class="result-item result-invalid">–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤</div>';
    });
}

function displayResults(results) {
    const resultsDiv = document.getElementById('checker-results');
    let html = '<h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:</h3>';
    
    let validCount = 0, limitedCount = 0, bannedCount = 0, invalidCount = 0;
    
    results.forEach(result => {
        const statusClass = `result-${result.status}`;
        const statusIcon = result.status === 'valid' ? '‚úÖ' : 
                          result.status === 'limited' ? '‚ö†Ô∏è' : 
                          result.status === 'banned' ? '‚ùå' : '‚ùì';
        
        html += `
            <div class="result-item ${statusClass}">
                <div class="result-header">
                    <strong>${result.account}</strong>
                    <span class="status-badge">${statusIcon} ${result.status.toUpperCase()}</span>
                </div>
                <div class="result-details">
                    ${result.details}
                    ${result.robux ? ` | üí∞ ${result.robux} Robux` : ''}
                    ${result.premium ? ' | ‚≠ê Premium' : ''}
                    ${result.items_count ? ` | üéí ${result.items_count} items` : ''}
                </div>
            </div>
        `;
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        if (result.status === 'valid') validCount++;
        else if (result.status === 'limited') limitedCount++;
        else if (result.status === 'banned') bannedCount++;
        else invalidCount++;
    });
    
    // –°–≤–æ–¥–∫–∞
    html += `
        <div class="results-summary">
            <h4>üìà –°–≤–æ–¥–∫–∞:</h4>
            <p>‚úÖ –í–∞–ª–∏–¥–Ω—ã—Ö: ${validCount} | ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö: ${limitedCount} | ‚ùå –ó–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö: ${bannedCount} | ‚ùì –ù–µ–≤–∞–ª–∏–¥–Ω—ã—Ö: ${invalidCount}</p>
        </div>
    `;
    
    resultsDiv.innerHTML = html;
}
</script>
{% endblock %}